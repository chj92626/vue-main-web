{"remainingRequest":"/Users/huajuncheng/Documents/git-prj/vue-main-web/node_modules/babel-loader/lib/index.js!/Users/huajuncheng/Documents/git-prj/vue-main-web/node_modules/eslint-loader/index.js??ref--14-0!/Users/huajuncheng/Documents/git-prj/vue-main-web/src/makeAllComponentRouter/index.js","dependencies":[{"path":"/Users/huajuncheng/Documents/git-prj/vue-main-web/src/makeAllComponentRouter/index.js","mtime":1666252172561},{"path":"/Users/huajuncheng/Documents/git-prj/vue-main-web/babel.config.js","mtime":1666252172553},{"path":"/Users/huajuncheng/Documents/git-prj/vue-main-web/node_modules/cache-loader/dist/cjs.js","mtime":1663934044279},{"path":"/Users/huajuncheng/Documents/git-prj/vue-main-web/node_modules/babel-loader/lib/index.js","mtime":1663934044381},{"path":"/Users/huajuncheng/Documents/git-prj/vue-main-web/node_modules/eslint-loader/index.js","mtime":1665751372775}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCB7IGF1dG9GaWxsQ29tcG9uZW50IH0gZnJvbSAnQC9tYWtlQWxsQ29tcG9uZW50Um91dGVyL21ha2VDb21wb25lbnRzLmpzJzsKaW1wb3J0IHsgYWRkQWxsUm91dGVzIH0gZnJvbSAnQC9tYWtlQWxsQ29tcG9uZW50Um91dGVyL21ha2VDb21wb25lbnRzLmpzJzsKaW1wb3J0IHsgcmVzZXRSb3V0ZXIgfSBmcm9tICdAL3JvdXRlci9pbmRleC5qcyc7CmltcG9ydCB7IHNwbGl0VXJsIH0gZnJvbSAnQC91dGlscy9xaWFua3VuTWV0aG9kcy5qcyc7CmltcG9ydCBWdWV4IGZyb20gJ0Avc3RvcmUvaW5kZXgnOwppbXBvcnQgeyBwcmVmZXRjaEFwcHMgfSBmcm9tICdxaWFua3VuJzsKCi8vIOaKveWHuuaJgOacieeahHRyZWXnu5PmnoTnmoTmnIDlkI7kuIDlsYLliqjmgIHot6/nlLHvvIzlgZpmbGF05aSE55CG77yM54S25ZCO5ou86KOF5oiQcWluYWt1buaooeW8j+OAggpmdW5jdGlvbiBtYWtlUGF0aEFycihtZW51cyA9IFtdKSB7CiAgY29uc3QgcGF0aEFyclRlbXAgPSBbXTsKICAvLyDnrKzkuIDlsYIKICBmb3IgKGxldCBmaXJzdEluZGV4ID0gMDsgZmlyc3RJbmRleCA8IG1lbnVzLmxlbmd0aDsgZmlyc3RJbmRleCsrKSB7CiAgICBjb25zdCBmaXJzdEVsZW1lbnQgPSBtZW51c1tmaXJzdEluZGV4XTsKICAgIGlmIChmaXJzdEVsZW1lbnQudXJsICYmIGZpcnN0RWxlbWVudC5pZCAmJiBmaXJzdEVsZW1lbnQubmFtZSkgewogICAgICBwYXRoQXJyVGVtcC5wdXNoKGZpcnN0RWxlbWVudCk7CiAgICB9CiAgfQogIHJldHVybiBwYXRoQXJyVGVtcDsKfQpleHBvcnQgY29uc3QgbWFrZUFsbFJvdXRlciA9IGZ1bmN0aW9uICgpIHsKICBjb25zdCBmdWxsUm91dGVyID0gW107CiAgY29uc3QgdXNlckluZm8gPSBKU09OLnBhcnNlKHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWxsVXNlckluZm8nKSB8fCAne30nKTsKICBjb25zdCBwcmVMb2FkQXJyID0gW107CiAgaWYgKHVzZXJJbmZvLm1lbnVzKSB7CiAgICBjb25zdCBwYXRoQXJyID0gbWFrZVBhdGhBcnIodXNlckluZm8ubWVudXMpOwogICAgY29uc29sZS5sb2coJ3BhdGhBcnI6JywgcGF0aEFycik7CiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgcGF0aEFyci5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgLy8g5ou85o6l5oiQcWlhbmt15LiT5bGe6Lev55SxCiAgICAgIGNvbnN0IGVsZW1lbnQgPSBwYXRoQXJyW2luZGV4XTsKICAgICAgY29uc3QgZnVsbFNpbmdsZVJvdXRlciA9IGF1dG9GaWxsQ29tcG9uZW50KGVsZW1lbnQpOwogICAgICBmdWxsUm91dGVyLnB1c2goZnVsbFNpbmdsZVJvdXRlcik7CiAgICAgIC8vIOmihOWKoOi9vQogICAgICBjb25zdCBwYXRoU3BsaXQgPSBzcGxpdFVybChlbGVtZW50LnVybCk7CiAgICAgIGNvbnN0IGhvc3QgPSBwYXRoU3BsaXRbMF07CiAgICAgIHByZUxvYWRBcnIucHVzaChob3N0KTsKICAgIH0KICB9IGVsc2UgewogICAgY29uc29sZS5sb2coJ+acqueZu+W9leaIluiAheW3sue7j+WIneWni+WMlui/h3JvdXRlcicpOwogIH0KICAvLyDpmaTkuobku47lkI7nq6/lj5blvpfnmbvlvZXmjqXlj6Pph4znmoTot6/nlLHku6XlpJbvvIzov5jmnInlrZjnmoTkuLTml7bot6/nlLHopoHlpITnkIYKICBjb25zdCB0ZW1wUm91dGVKc29uID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0ZW1wUm91dGVKc29uJyk7CiAgY29uc3QgdGVtcFJvdXRlID0gdGVtcFJvdXRlSnNvbiA/IEpTT04ucGFyc2UodGVtcFJvdXRlSnNvbikgOiBbXTsKICBpZiAodGVtcFJvdXRlLmxlbmd0aCA+IDApIHsKICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0ZW1wUm91dGUubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIGNvbnN0IGVsZW1lbnQgPSB0ZW1wUm91dGVbaW5kZXhdIHx8IHt9OwogICAgICBjb25zdCBmdWxsU2luZ2xlUm91dGVyID0gYXV0b0ZpbGxDb21wb25lbnQoZWxlbWVudCwgdHJ1ZSk7CiAgICAgIGZ1bGxSb3V0ZXIucHVzaChmdWxsU2luZ2xlUm91dGVyKTsKICAgIH0KICB9CiAgaWYgKGZ1bGxSb3V0ZXIubGVuZ3RoID4gMCkgewogICAgLy8g5Yi26YCg6Lev55Sx5LmL5YmN5YWI5Yid5aeL5YyW6Lev55SxCiAgICByZXNldFJvdXRlcigpOwogICAgY29uc29sZS5sb2coJ+WItumAoOWlveeahOWFqOmHj3FpYW5rdW7ot6/nlLHkuLo6JywgZnVsbFJvdXRlcik7CiAgICBhZGRBbGxSb3V0ZXMoZnVsbFJvdXRlcik7CiAgfSBlbHNlIHsKICAgIC8vIGNvbnNvbGUubG9nKCflvIDlp4vmiafooYxyZW1vdmVUb2tlbi1tYWtlQWxsUm91dGVyJykKICAgIC8vIHJlbW92ZVRva2VuKCkKICAgIGNvbnNvbGUubG9nKCfmsqHmnInoj5zljZUnKTsKICB9CgogIC8vIOW8gOWni+mihOWKoOi9vQogIGNvbnN0IHByZUxvYWRBcnJTZXQgPSBbLi4ubmV3IFNldChwcmVMb2FkQXJyKV07CiAgY29uc29sZS5sb2cocHJlTG9hZEFyclNldCwgJ3ByZUxvYWRBcnInKTsKICAvLyDmmoLlrZjliLB2dWV4CiAgVnVleC5jb21taXQoJ3Blcm1pc3Npb24vQ0hBTkdFX1BSRUxPQUQnLCBwcmVMb2FkQXJyU2V0KTsKICBjb25zdCBxaWFua3VuQ29uZmlnQXJyID0gcHJlTG9hZEFyclNldC5tYXAoKHByZUxvYWQsIGluZGV4KSA9PiB7CiAgICByZXR1cm4gewogICAgICBuYW1lOiBgcWlhbmt1blByZWxvYWRTdWJhcHAke2luZGV4fWAsCiAgICAgIGVudHJ5OiBwcmVMb2FkCiAgICB9OwogIH0pOwogIGlmICghd2luZG93Lmhhc1ByZWxvYWRTdWJBcHApIHsKICAgIHByZWZldGNoQXBwcyhxaWFua3VuQ29uZmlnQXJyKTsKICAgIHdpbmRvdy5oYXNQcmVsb2FkU3ViQXBwID0gdHJ1ZTsKICB9Cn07"},{"version":3,"names":["autoFillComponent","addAllRoutes","resetRouter","splitUrl","Vuex","prefetchApps","makePathArr","menus","pathArrTemp","firstIndex","length","firstElement","url","id","name","push","makeAllRouter","fullRouter","userInfo","JSON","parse","window","localStorage","getItem","preLoadArr","pathArr","console","log","index","element","fullSingleRouter","pathSplit","host","tempRouteJson","tempRoute","preLoadArrSet","Set","commit","qiankunConfigArr","map","preLoad","entry","hasPreloadSubApp"],"sources":["/Users/huajuncheng/Documents/git-prj/vue-main-web/src/makeAllComponentRouter/index.js"],"sourcesContent":["import { autoFillComponent } from '@/makeAllComponentRouter/makeComponents.js'\nimport { addAllRoutes } from '@/makeAllComponentRouter/makeComponents.js'\nimport { resetRouter } from '@/router/index.js'\nimport { splitUrl } from '@/utils/qiankunMethods.js'\nimport Vuex from '@/store/index'\nimport { prefetchApps } from 'qiankun'\n\n// 抽出所有的tree结构的最后一层动态路由，做flat处理，然后拼装成qinakun模式。\nfunction makePathArr(menus = []) {\n  const pathArrTemp = []\n  // 第一层\n  for (let firstIndex = 0; firstIndex < menus.length; firstIndex++) {\n    const firstElement = menus[firstIndex]\n    if (firstElement.url && firstElement.id && firstElement.name) {\n      pathArrTemp.push(firstElement)\n    }\n  }\n  return pathArrTemp\n}\n\nexport const makeAllRouter = function() {\n  const fullRouter = []\n  const userInfo = JSON.parse(window.localStorage.getItem('allUserInfo') || '{}')\n  const preLoadArr = []\n  if (userInfo.menus) {\n    const pathArr = makePathArr(userInfo.menus)\n    console.log('pathArr:', pathArr)\n    for (let index = 0; index < pathArr.length; index++) {\n      // 拼接成qianku专属路由\n      const element = pathArr[index]\n      const fullSingleRouter = autoFillComponent(element)\n      fullRouter.push(fullSingleRouter)\n      // 预加载\n      const pathSplit = splitUrl(element.url)\n      const host = pathSplit[0]\n      preLoadArr.push(host)\n    }\n  } else {\n    console.log('未登录或者已经初始化过router')\n  }\n  // 除了从后端取得登录接口里的路由以外，还有存的临时路由要处理\n  const tempRouteJson = window.localStorage.getItem('tempRouteJson')\n  const tempRoute = tempRouteJson ? JSON.parse(tempRouteJson) : []\n  if (tempRoute.length > 0) {\n    for (let index = 0; index < tempRoute.length; index++) {\n      const element = tempRoute[index] || {}\n      const fullSingleRouter = autoFillComponent(element, true)\n      fullRouter.push(fullSingleRouter)\n    }\n  }\n  if (fullRouter.length > 0) {\n    // 制造路由之前先初始化路由\n    resetRouter()\n    console.log('制造好的全量qiankun路由为:', fullRouter)\n    addAllRoutes(fullRouter)\n  } else {\n    // console.log('开始执行removeToken-makeAllRouter')\n    // removeToken()\n    console.log('没有菜单')\n  }\n\n  // 开始预加载\n  const preLoadArrSet = [...new Set(preLoadArr)]\n  console.log(preLoadArrSet, 'preLoadArr')\n  // 暂存到vuex\n  Vuex.commit('permission/CHANGE_PRELOAD', preLoadArrSet)\n  const qiankunConfigArr = preLoadArrSet.map((preLoad, index) => {\n    return {\n      name: `qiankunPreloadSubapp${index}`,\n      entry: preLoad\n    }\n  })\n  if (!window.hasPreloadSubApp) {\n    prefetchApps(qiankunConfigArr)\n    window.hasPreloadSubApp = true\n  }\n}\n\n"],"mappings":"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"}]}