{"remainingRequest":"/Users/huajuncheng/Documents/git-prj/vue-main-web/node_modules/babel-loader/lib/index.js!/Users/huajuncheng/Documents/git-prj/vue-main-web/node_modules/eslint-loader/index.js??ref--14-0!/Users/huajuncheng/Documents/git-prj/vue-main-web/src/initQiankunState/index.js","dependencies":[{"path":"/Users/huajuncheng/Documents/git-prj/vue-main-web/src/initQiankunState/index.js","mtime":1666252172561},{"path":"/Users/huajuncheng/Documents/git-prj/vue-main-web/babel.config.js","mtime":1666252172553},{"path":"/Users/huajuncheng/Documents/git-prj/vue-main-web/node_modules/cache-loader/dist/cjs.js","mtime":1663934044279},{"path":"/Users/huajuncheng/Documents/git-prj/vue-main-web/node_modules/babel-loader/lib/index.js","mtime":1663934044381},{"path":"/Users/huajuncheng/Documents/git-prj/vue-main-web/node_modules/eslint-loader/index.js","mtime":1665751372775}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgaW5pdEdsb2JhbFN0YXRlIH0gZnJvbSAncWlhbmt1bic7CmltcG9ydCB7IGdvVG9Sb3V0ZXIgfSBmcm9tICcuL25hdmlnYXRvci5qcyc7CmltcG9ydCB7IGNsZWFyTG9naW4gfSBmcm9tICdAL3V0aWxzL3Rva2VuRXhwaXJlZC5qcyc7CmV4cG9ydCBjb25zdCBpbml0U3RhdGUgPSBmdW5jdGlvbiAoKSB7CiAgY29uc29sZS5sb2coJ+W8gOWni+WIneWni+WMlnN0YXRlJyk7CiAgY29uc3QgYWxsSW5mb0pTT04gPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FsbFVzZXJJbmZvJykgfHwgJ3t9JzsKICAvLyDmsqHliJ3lp4vljJbov4fkuJTmnInmlbDmja4KICBpZiAoIXdpbmRvdy5hY3Rpb25zUWlhbmt1bikgewogICAgY29uc3QgYWxsSW5mbyA9IEpTT04ucGFyc2UoYWxsSW5mb0pTT04pOwogICAgd2luZG93LmFjdGlvbnNRaWFua3VuID0gaW5pdEdsb2JhbFN0YXRlKHsKICAgICAgYXV0aFRva2VuOiBhbGxJbmZvLmF1dGhUb2tlbiwKICAgICAgYXBwTmFtZTogJycsCiAgICAgIGV2ZW50VHlwZTogJycsCiAgICAgIHRoZW1lOiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3RoZW1lJykgfHwgJ2RhcmsnLAogICAgICByb3V0ZVBhcmFtczoge30sCiAgICAgIHN1YkFwcE9wdGlvbnM6IHt9CiAgICB9KTsKICAgIHdpbmRvdy5hY3Rpb25zUWlhbmt1bi5vbkdsb2JhbFN0YXRlQ2hhbmdlKChzdGF0ZSwgcHJldikgPT4gewogICAgICBjb25zb2xlLmxvZygn5a2Q5bqU55So5pS25Yiw55qE5YWo6YePc3RhdGUnLCBzdGF0ZSk7CiAgICAgIC8vIOWkhOeQhui3r+eUsei3s+i9rAogICAgICBpZiAoc3RhdGUuZXZlbnRUeXBlID09PSAnTkFWSUdBVEVUTycgJiYgc3RhdGUucm91dGVQYXJhbXMpIHsKICAgICAgICBjb25zb2xlLmxvZygn5byA5aeL6Lev55Sx6Lez6L2sJywgc3RhdGUucm91dGVQYXJhbXMpOwogICAgICAgIGdvVG9Sb3V0ZXIoc3RhdGUpOwogICAgICB9CiAgICAgIC8vIOWkhOeQhui/h+acnwogICAgICBpZiAoc3RhdGUuZXZlbnRUeXBlID09PSAnVE9LRU5fRVhQSVJFRCcpIHsKICAgICAgICBjb25zb2xlLmxvZygn55m75b2V6L+H5pyfJyk7CiAgICAgICAgY2xlYXJMb2dpbigpOwogICAgICB9CiAgICB9KTsKICB9IGVsc2UgewogICAgY29uc29sZS5sb2coJ+W3sue7j+WIneWni+WMlui/h3N0YXRlJyk7CiAgfQp9Ow=="},{"version":3,"names":["initGlobalState","goToRouter","clearLogin","initState","console","log","allInfoJSON","window","localStorage","getItem","actionsQiankun","allInfo","JSON","parse","authToken","appName","eventType","theme","routeParams","subAppOptions","onGlobalStateChange","state","prev"],"sources":["/Users/huajuncheng/Documents/git-prj/vue-main-web/src/initQiankunState/index.js"],"sourcesContent":["import { initGlobalState } from 'qiankun'\nimport { goToRouter } from './navigator.js'\nimport { clearLogin } from '@/utils/tokenExpired.js'\n\nexport const initState = function() {\n  console.log('开始初始化state')\n  const allInfoJSON = window.localStorage.getItem('allUserInfo') || '{}'\n  // 没初始化过且有数据\n  if (!window.actionsQiankun) {\n    const allInfo = JSON.parse(allInfoJSON)\n    window.actionsQiankun = initGlobalState({\n      authToken: allInfo.authToken,\n      appName: '',\n      eventType: '',\n      theme: window.localStorage.getItem('theme') || 'dark',\n      routeParams: {},\n      subAppOptions: {}\n    })\n    window.actionsQiankun.onGlobalStateChange((state, prev) => {\n      console.log('子应用收到的全量state', state)\n      // 处理路由跳转\n      if (state.eventType === 'NAVIGATETO' && state.routeParams) {\n        console.log('开始路由跳转', state.routeParams)\n        goToRouter(state)\n      }\n      // 处理过期\n      if (state.eventType === 'TOKEN_EXPIRED') {\n        console.log('登录过期')\n        clearLogin()\n      }\n    })\n  } else {\n    console.log('已经初始化过state')\n  }\n}\n"],"mappings":"AAAA,SAASA,eAAe,QAAQ,SAAS;AACzC,SAASC,UAAU,QAAQ,gBAAgB;AAC3C,SAASC,UAAU,QAAQ,yBAAyB;AAEpD,OAAO,MAAMC,SAAS,GAAG,YAAW;EAClCC,OAAO,CAACC,GAAG,CAAC,YAAY,CAAC;EACzB,MAAMC,WAAW,GAAGC,MAAM,CAACC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,IAAI,IAAI;EACtE;EACA,IAAI,CAACF,MAAM,CAACG,cAAc,EAAE;IAC1B,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACP,WAAW,CAAC;IACvCC,MAAM,CAACG,cAAc,GAAGV,eAAe,CAAC;MACtCc,SAAS,EAAEH,OAAO,CAACG,SAAS;MAC5BC,OAAO,EAAE,EAAE;MACXC,SAAS,EAAE,EAAE;MACbC,KAAK,EAAEV,MAAM,CAACC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,IAAI,MAAM;MACrDS,WAAW,EAAE,CAAC,CAAC;MACfC,aAAa,EAAE,CAAC;IAClB,CAAC,CAAC;IACFZ,MAAM,CAACG,cAAc,CAACU,mBAAmB,CAAC,CAACC,KAAK,EAAEC,IAAI,KAAK;MACzDlB,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEgB,KAAK,CAAC;MACnC;MACA,IAAIA,KAAK,CAACL,SAAS,KAAK,YAAY,IAAIK,KAAK,CAACH,WAAW,EAAE;QACzDd,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEgB,KAAK,CAACH,WAAW,CAAC;QACxCjB,UAAU,CAACoB,KAAK,CAAC;MACnB;MACA;MACA,IAAIA,KAAK,CAACL,SAAS,KAAK,eAAe,EAAE;QACvCZ,OAAO,CAACC,GAAG,CAAC,MAAM,CAAC;QACnBH,UAAU,EAAE;MACd;IACF,CAAC,CAAC;EACJ,CAAC,MAAM;IACLE,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC;EAC5B;AACF,CAAC"}]}